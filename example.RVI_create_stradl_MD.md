Example script for RVI
================
Xueyi Shen
September 11, 2020

-----

### Contact and credit

X Shen (<xueyi.shen@ed.ac.uk>, emails replied on Wednesdays and Fridays)

Reference:
<https://ajp.psychiatryonline.org/doi/pdf/10.1176/appi.ajp.2019.18101212>

-----

### R settings

Required packages: dplyr, pbapply

Source file: create\_RVI.R

``` r
library(dplyr)
library(pbapply)
library(knitr)
```

-----

### Summary

This is an example script for creating RVI using stradl MD(mean
diffusivity) data

Reference beta came from the [ENIGMA
paper](https://www.nature.com/articles/s41380-019-0477-2)(2020).

Reference beta downloaded from [Table
S5](https://static-content.springer.com/esm/art%3A10.1038%2Fs41380-019-0477-2/MediaObjects/41380_2019_477_MOESM2_ESM.docx).

-----

### Prepare inputs

##### Load MD data

``` r
stradl.dti.MD=read.csv('/exports/igmm/eddie/GenScotDepression/shen/bakup.dat/stradl_imaging/DTI/STRADL_Measures_DTI_MD.csv',header=T,stringsAsFactors=F)

# Select columns that match the reference beta data
stradl.dti.MD <- stradl.dti.MD %>%
                 (function(x) x[,!grepl('\\.L$|\\.R$',colnames(x))])

colnames(stradl.dti.MD)=gsub('AverageFA','AverageMD',colnames(stradl.dti.MD))

# Add covariates
control.id=readRDS('../data/identify_controlsample.rds')
linkage.dat=readRDS('/exports/igmm/eddie/GenScotDepression/shen/bakup.dat/stradl_imaging/DataLinkage/Methylation_Genotype_Imaging_linkageID.rds')
control.id = merge(control.id,linkage.dat,by.x='ID',by.y='genotype_ID',all.y=T)

stradl.dti.MD=merge(stradl.dti.MD,control.id[,c('stradl_ID','sex','age')],by.x='subjectID',by.y='stradl_ID',all.x=T)

head(stradl.dti.MD)
```

    ##    subjectID         ACR        ALIC   AverageMD         BCC          CC
    ## 1 ST1AAB0001 0.000710723 0.000666588 0.000714760 0.000747007 0.000729609
    ## 2 ST1AAB0002 0.000738568 0.000685848 0.000757621 0.000852383 0.000796037
    ## 3 ST1AAB0003 0.000711590 0.000682694 0.000737043 0.000796512 0.000751346
    ## 4 ST1AAB0005 0.000703508 0.000667506 0.000722861 0.000713882 0.000696042
    ## 5 ST1AAB0006 0.000746704 0.000742564 0.000759803 0.000799317 0.000753077
    ## 6 ST1AAB0007 0.000758889 0.000678154 0.000744504 0.000824863 0.000793535
    ##           CGC         CGH          CR         CST          EC         FX
    ## 1 0.000737745 0.000564186 0.000695587 0.000659341 0.000738527 0.00163189
    ## 2 0.000712389 0.000646387 0.000717313 0.000658311 0.000802129 0.00207291
    ## 3 0.000709082 0.000675983 0.000696134 0.000583498 0.000768899 0.00182834
    ## 4 0.000758781 0.000658091 0.000690679 0.000615424 0.000739110 0.00141247
    ## 5 0.000746311 0.000582641 0.000723587 0.000625576 0.000915042 0.00184142
    ## 6 0.000716693 0.000633465 0.000729095 0.000586957 0.000758721 0.00204362
    ##          FXST         GCC          IC         IFO         PCR        PLIC
    ## 1 0.000696042 0.000716948 0.000613273 0.000719505 0.000719131 0.000525648
    ## 2 0.000767459 0.000754336 0.000661611 0.000803014 0.000752549 0.000593084
    ## 3 0.000757853 0.000711634 0.000659864 0.000796035 0.000719501 0.000574785
    ## 4 0.000720434 0.000681917 0.000658167 0.000793009 0.000714190 0.000627895
    ## 5 0.000694546 0.000732709 0.000663373 0.000819191 0.000739340 0.000571329
    ## 6 0.000706864 0.000752931 0.000661301 0.000769481 0.000765048 0.000564962
    ##           PTR        RLIC         SCC         SCR         SFO         SLF
    ## 1 0.000740793 0.000663310 0.000715768 0.000666358 0.000633014 0.000651031
    ## 2 0.000758076 0.000718456 0.000751768 0.000675146 0.000624653 0.000684446
    ## 3 0.000759459 0.000737766 0.000720849 0.000666637 0.000649764 0.000677194
    ## 4 0.000765412 0.000684657 0.000682756 0.000664068 0.000606146 0.000680379
    ## 5 0.000771547 0.000692651 0.000705752 0.000689401 0.000699143 0.000714203
    ## 6 0.000813283 0.000758597 0.000782745 0.000676939 0.000642209 0.000684716
    ##            SS         UNC sex age
    ## 1 0.000719779 0.000916701   M  56
    ## 2 0.000772503 0.000882565   M  59
    ## 3 0.000780894 0.000855953   F  57
    ## 4 0.000723602 0.000787786   F  59
    ## 5 0.000747264 0.000797464   F  59
    ## 6 0.000781758 0.000956080   M  58

##### Specify covariates

``` r
ls.covs.stradl=c('age','sex')
```

##### Specify healthy controls (free from any psychiatric condition)

``` r
ls.control.ID.stradl = control.id$stradl_ID[control.id$is_control]
head(ls.control.ID.stradl)
```

    ## [1] "ST1GDU2497" "ST1WDU2444" "ST1GDU2317" "ST1GDU2562" "ST1WDU2279"
    ## [6] "ST1GDU2370"

##### Reference data (ENIGMA beta)

``` r
beta.MD.enigma=read.delim('../data/ENIGMA_effectsizes_MD.txt',header=F,stringsAsFactors=F)
head(beta.MD.enigma)
```

    ##     V1    V2
    ## 1  ACR 0.065
    ## 2 ALIC 0.124
    ## 3  BCC 0.192
    ## 4   CC 0.170
    ## 5  CGC 0.085
    ## 6  CGH 0.140

-----

### Source create\_RVI function

``` r
source('create_RVI.R')
```

-----

### Run create\_RVI function

``` r
RVI.stradl.MD=create_RVI(x=stradl.dti.MD,
                         ls.covs=ls.covs.stradl,
                         ls.control.ID=ls.control.ID.stradl,
                         ref.beta=beta.MD.enigma)
```

    ## [1] "Correct for confounders"
    ## [1] "RVI step 1"
    ## [1] "RVI step 2"
    ## Rows: 1,037
    ## Columns: 2
    ## $ ID  <chr> "ST1AAB0001", "ST1AAB0002", "ST1AAB0003", "ST1AAB0005", "ST1…
    ## $ RVI <dbl> -0.19009486, 0.18987320, 0.16345786, -0.31685772, 0.13022340…

The output will look like:

``` r
head(RVI.stradl.MD)
```

    ##           ID        RVI
    ## 1 ST1AAB0001 -0.1900949
    ## 2 ST1AAB0002  0.1898732
    ## 3 ST1AAB0003  0.1634579
    ## 4 ST1AAB0005 -0.3168577
    ## 5 ST1AAB0006  0.1302234
    ## 6 ST1AAB0007 -0.1520602
